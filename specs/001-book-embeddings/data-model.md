# Data Model: Book Content Embedding System

## Entities

### Book Content Chunk
- **Description**: A semantic unit of book content derived from Markdown files, suitable for embedding generation
- **Fields**:
  - id: Unique identifier for the chunk (string or integer)
  - content: The text content of the chunk (string)
  - document_path: Relative path inside /docs (string)
  - section_type: Type of section (intro, hardware, module) (string)
  - module_name: Name of the module if applicable (string, optional)
  - chapter_name: Name of the chapter or filename (string)
  - section_heading: Nearest Markdown heading (string)
  - language: Language code (default: "en") (string)
  - source_type: Type of source (constant: "book") (string)
  - indexing_version: Timestamp or version identifier (string)
  - embedding: Vector representation of the content (array of floats)
  - vector_id: Unique identifier for the vector in Qdrant (string)

### Vector Embedding
- **Description**: Numerical representation of a content chunk generated by the Cohere embedding model
- **Fields**:
  - vector_id: Unique identifier for the vector (string)
  - vector_data: Array of float values representing the embedding (array of floats)
  - chunk_id: Reference to the original chunk (string)
  - model_used: Name of the embedding model used (string)
  - created_at: Timestamp of embedding creation (datetime)

### Qdrant Vector Point
- **Description**: Storage unit in Qdrant containing the vector embedding and associated metadata
- **Fields**:
  - point_id: Unique identifier in Qdrant (string)
  - vector: Array of float values (array of floats)
  - payload: Metadata object containing document_path, section_type, module_name, etc. (object)
  - collection_name: Name of the Qdrant collection (string)

### Metadata Payload
- **Description**: Information associated with each vector point that enables traceability back to source content
- **Fields**:
  - document_path: Relative path inside /docs (string)
  - section_type: Type of section (intro, hardware, module) (string)
  - module_name: Name of the module if applicable (string, optional)
  - chapter_name: Name of the chapter or filename (string)
  - section_heading: Nearest Markdown heading (string)
  - language: Language code (default: "en") (string)
  - source_type: Type of source (constant: "book") (string)
  - indexing_version: Timestamp or version identifier (string)

## Relationships

- One Book Content Chunk → One Vector Embedding (1:1)
- One Vector Embedding → One Qdrant Vector Point (1:1)
- One Qdrant Vector Point → One Metadata Payload (1:1)

## Validation Rules

### Book Content Chunk
- content must not exceed Cohere embedding input limits
- document_path must be a valid relative path under /docs
- section_type must be one of: "intro", "hardware", "module"
- language must be a valid language code
- source_type must equal "book"

### Vector Embedding
- vector_data must have exactly 1024 dimensions (as per environment variable)
- model_used must match COHERE_MODEL environment variable
- created_at must be a valid timestamp

### Qdrant Vector Point
- point_id must be unique within the collection
- vector must have size matching QDRANT_VECTOR_SIZE environment variable
- collection_name must match QDRANT_COLLECTION_NAME environment variable

### Metadata Payload
- All required fields must be present
- document_path must correspond to an actual file in the /docs directory
- section_heading must correspond to an actual heading in the source document